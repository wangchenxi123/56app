webpackJsonp([14],{144:function(t,e,a){a(303);var s=a(6)(a(249),a(351),null,null);t.exports=s.exports},249:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a(7);e.default={data:function(){return{minHeight:"",phonePopupVisible:!1,pwdPopupVisible:!1,uploading:!1,updatePhoneData:{phone:"",oldSms:"",newSms:""},oldCodeMessage:"获取验证码",newCodeMessage:"获取验证码",oldCodeGetting:!1,newCodeGetting:!1,phoneErrorMessage:"",updatePhoneState:{phone:""},updatePwdData:{oldPassword:"",newPassword:"",pwdConfirm:"",sms:""},updatePwdState:{oldPassword:"",newPassword:"",pwdConfirm:""},pwdConfirmMessage:"",updatePwding:!1,updatePhoneing:!1,updatePwdByPhone:!1,pwdCodeMessage:"获取验证码",pwdCodeGetting:!1}},computed:{user:function(){return this.$global.USER}},created:function(){},activated:function(){this.minHeight=window.innerHeight-103},methods:{routerBack:function(){this.$router.go(-1)},openNamePrompt:function(){var t=this,e=this.user.username?"修改用户名":"新用户名";this.$messageBox.prompt(" ",e).then(function(e){var a=e.value,s=e.action;a&&a.trim()&&"confirm"===s&&t.$api.updateUserName(a,function(e){t.$set(t.$global.USER,"username",a),t.$toast({message:"修改成功",iconClass:"mintui mintui-success",duration:1e3})},function(e){t.$toast({message:e.message})})}).catch(function(t){})},showPhonePopup:function(){this.phonePopupVisible=!0,this.updatePhoneData={phone:"",oldSms:"",newSms:""},this.phoneErrorMessage="",this.updatePhoneState={phone:""}},showPwdPopup:function(){this.pwdPopupVisible=!0,this.updatePwdData={oldPassword:"",newPassword:"",pwdConfirm:""},this.updatePwdState={oldPassword:"",newPassword:"",pwdConfirm:""},this.pwdConfirmMessage=""},updatePhone:function(){var t=this;!this.phoneErrorMessage&&this.updatePhoneData.oldSms&&this.updatePhoneData.newSms&&this.updatePhoneData.phone&&(this.updatePhoneing||(this.updatePhoneing=!0,this.$api.updateUserPhone(this.updatePhoneData,function(e){t.$set(t.$global.USER,"iphone",t.updatePhoneData.phone),t.phonePopupVisible=!1,t.updatePhoneing=!1,t.$toast({message:"修改成功",iconClass:"mintui mintui-success",duration:1e3})},function(e){t.phonePopupVisible=!1,t.updatePhoneing=!1,t.toast("修改失败,"+e.message)})))},pwdChange:function(){this.updatePwdByPhone=!this.updatePwdByPhone,this.updatePwdData={oldPassword:"",newPassword:"",pwdConfirm:"",sms:""}},updatePwd:function(){var t=this;if(this.updatePwdByPhone){if(!this.updatePwdData.sms)return}else if(!this.updatePwdData.oldPassword)return;!this.pwdConfirmMessage&&this.updatePwdData.newPassword&&this.updatePwdData.pwdConfirm&&(this.updatePwding||(this.updatePwding=!0,this.$api.updateUserPwd(this.updatePwdData,function(e){t.pwdPopupVisible=!1,t.updatePwding=!1,t.$toast({message:"修改成功",iconClass:"mintui mintui-success",duration:1e3})},function(e){t.pwdPopupVisible=!1,t.updatePwding=!1,t.toast("修改失败,"+e.message)})))},upload:function(t){var e=this,a=t.target.files[0];if(t.target.value=null,!/image\/\w+/.test(a.type))return void this.$toast({message:"只能上传图片"});if(a.size>=5e6)return void this.$toast({message:"图片不能大于5M"});var s=new FormData;s.append("file",a),s.append("type","IMAGE"),this.uploading=!0,this.$api.uploadImage(s,function(t){var a=t;e.$api.updateUserHeadPic(a.file.id,function(t){e.$set(e.$global.USER,"head_pic",a.file.id)},function(t){e.$toast({message:t.message})}),e.uploading=!1},function(t){e.$toast({message:t.message}),e.uploading=!1})},loadTop:function(){var t=this;this.$api.getUserInfo("",function(e){t.$global.USER=e.resource,t.$refs.loadTop.onTopLoaded()},function(e){t.$refs.loadTop.onTopLoaded(),"401"!==e.responseCode?t.$toast({message:e.message}):t.$router.replace({name:"login"})})},checkPwd:function(){return this.updatePwdData.pwdConfirm!==this.updatePwdData.newPassword?(this.updatePwdState.pwdConfirm="error",this.pwdConfirmMessage="两次密码不一致",!1):(this.updatePwdState.pwdConfirm="",this.pwdConfirmMessage="",!0)},check:function(t){var e=this;this.validateField(t,this.updatePhoneData)&&this.$api.detection(this.updatePhoneData[t],function(a){a.result?(e.updatePhoneState[t]="success",e.phoneErrorMessage=""):(e.updatePhoneState[t]="error","phone"===t&&(e.phoneErrorMessage="此手机号已存在",e.toast("此手机号已存在")))},function(a){e.updatePhoneState[t]="error",e.phoneErrorMessage="检测失败",e.toast("检测失败,"+a.message)})},validateField:function(t,e){var a=!0;switch(t){case"phone":/^(((13[0-9]{1})|(14[579]{1})|(15[0-35-9]{1})|(17[0135-8]{1})|(18[0-9]{1}))+\d{8})$/.test(e.phone)||(this.toast("请输入正确手机号"),this.phoneErrorMessage="请输入正确手机号",this.updatePhoneState.phone="error",a=!1)}return a},getCode:function(t){var e=this;if("old"===t){if(!this.oldCodeGetting&&this.user.iphone){this.oldCodeGetting=!0,this.oldCodeMessage=60;var a=setInterval(function(){0===e.oldCodeMessage?(e.oldCodeMessage="获取验证码",e.oldCodeGetting=!1,window.clearInterval(a)):e.oldCodeMessage--},1e3);this.$api.postCode(this.user.iphone,function(t){e.toast("验证码发送成功")},function(t){e.oldCodeGetting=!1,window.clearInterval(a),e.oldCodeMessage="获取验证码",e.toast("验证码发送失败")})}}else if("new"===t){if(!this.newCodeGetting&&this.validateField("phone",this.updatePhoneData)){if(this.phoneErrorMessage)return;this.newCodeGetting=!0,this.newCodeMessage=60;var s=setInterval(function(){0===e.newCodeMessage?(e.newCodeMessage="获取验证码",e.newCodeGetting=!1,window.clearInterval(s)):e.newCodeMessage--},1e3);this.$api.postCode(this.updatePhoneData.phone,function(t){e.toast("验证码发送成功")},function(t){e.newCodeGetting=!1,window.clearInterval(s),e.newCodeMessage="获取验证码",e.toast("验证码发送失败")})}}else if("pwd"===t&&!this.pwdCodeGetting&&this.user.iphone){this.pwdCodeGetting=!0,this.pwdCodeMessage=60;var o=setInterval(function(){0===e.pwdCodeMessage?(e.pwdCodeMessage="获取验证码",e.pwdCodeGetting=!1,window.clearInterval(o)):e.pwdCodeMessage--},1e3);this.$api.postCode(this.user.iphone,function(t){e.toast("验证码发送成功")},function(t){e.pwdCodeGetting=!1,window.clearInterval(o),e.pwdCodeMessage="获取验证码",e.toast("验证码发送失败")})}},toast:function(t){this.toastClient&&this.toastClient.close(),this.toastClient=this.$toast({message:t,position:"middle",duration:2e3})}}}},269:function(t,e,a){e=t.exports=a(111)(!1),e.push([t.i,"img.item-head{width:32px;height:32px;border-radius:16px}.mint-popup-fade{width:100%;height:100%;background-color:#fbfbfb}.mint-popup-fade .mint-button.confirmBtn{width:90%;margin:10px auto}.formItemButton{position:absolute;z-index:2001}.update-title{display:block;text-align:center;padding:10px 0}.update-title h5{font-weight:400;font-size:18px;color:#333}.update-title img{width:30%;margin:10px auto}.auctionFormBtn{position:absolute;right:10px;width:80px;top:-18px}.mint-field-core{width:50%}.mint-msgbox-title{font-size:16px;font-weight:400}.mint-msgbox-input input{height:32px;line-height:32px;padding-top:0}input.fileInput{background-color:transparent;opacity:0;position:absolute;width:100%;height:48px;left:0;z-index:3}",""])},303:function(t,e,a){var s=a(269);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a(112)("39f2ebf8",s,!0)},351:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"userInfo"},[a("div",{staticClass:"page-wrap"},[a("div",{staticClass:"page-title"},[a("a",{on:{click:t.routerBack}},[a("i",{staticClass:"icon-back"})]),t._v(" "),a("span",[t._v("个人设置")])]),t._v(" "),a("mt-loadmore",{ref:"loadTop",staticStyle:{"padding-top":"48px"},attrs:{"top-method":t.loadTop}},[a("div",{staticClass:"page-content",staticStyle:{"padding-top":"0px"},style:{minHeight:t.minHeight+"px"}},[a("mt-cell",{attrs:{title:"头像","is-link":""}},[a("img",{staticClass:"item-head",attrs:{src:t.$api.file.see(t.user.head_pic),alt:"头像"}}),t._v(" "),a("input",{staticClass:"fileInput",attrs:{type:"file"},on:{change:function(e){t.upload(e)}}})]),t._v(" "),a("mt-cell",{attrs:{title:"用户名","is-link":""},nativeOn:{click:function(e){t.openNamePrompt(e)}}},[a("span",[t._v(t._s(t.user.username))])]),t._v(" "),a("mt-cell",{attrs:{title:"手机号码","is-link":""},nativeOn:{click:function(e){t.showPhonePopup()}}},[a("span",[t._v(t._s(t.user.iphone))])]),t._v(" "),a("mt-cell",{attrs:{title:"用户密码","is-link":""},nativeOn:{click:function(e){t.showPwdPopup()}}},[a("span",[t._v("修改")])]),t._v(" "),a("br"),t._v(" "),a("mt-cell",{attrs:{title:"用户ID"}},[a("span",[t._v(t._s(t.user.id))])])],1)])],1),t._v(" "),a("mt-popup",{staticClass:"mint-popup-fade",attrs:{position:"right",modal:!1},model:{value:t.phonePopupVisible,callback:function(e){t.phonePopupVisible=e},expression:"phonePopupVisible"}},[a("div",{staticClass:"update-title"},[a("img",{attrs:{src:"static/img/img-update.svg"}}),t._v(" "),a("h5",[t._v("修改用户手机号")])]),t._v(" "),a("mt-field",{attrs:{label:"旧手机号",type:"tel",readonly:!0},model:{value:t.user.iphone,callback:function(e){t.$set(t.user,"iphone",e)},expression:"user.iphone"}}),t._v(" "),a("mt-field",{attrs:{label:"手机验证码"},model:{value:t.updatePhoneData.oldSms,callback:function(e){t.$set(t.updatePhoneData,"oldSms",e)},expression:"updatePhoneData.oldSms"}},[a("div",{},[a("mt-button",{attrs:{size:"small",type:"default"},on:{click:function(e){t.getCode("old")}}},[t._v(t._s(t.oldCodeMessage))])],1)]),t._v(" "),a("br"),t._v(" "),a("mt-field",{attrs:{label:"新手机号",type:"tel",state:t.updatePhoneState.phone,attr:{maxLength:11}},nativeOn:{"!blur":function(e){t.check("phone")}},model:{value:t.updatePhoneData.phone,callback:function(e){t.$set(t.updatePhoneData,"phone",e)},expression:"updatePhoneData.phone"}}),t._v(" "),a("div",{staticStyle:{color:"red","font-size":"14px","text-align":"center"}},[t._v(t._s(t.phoneErrorMessage))]),t._v(" "),a("mt-field",{attrs:{label:"手机验证码"},model:{value:t.updatePhoneData.newSms,callback:function(e){t.$set(t.updatePhoneData,"newSms",e)},expression:"updatePhoneData.newSms"}},[a("mt-button",{attrs:{size:"small",type:"default"},on:{click:function(e){t.getCode("new")}}},[t._v(t._s(t.newCodeMessage))])],1),t._v(" "),a("br"),t._v(" "),a("mt-button",{staticClass:"confirmBtn",attrs:{size:"large",type:"danger"},on:{click:t.updatePhone}},[t._v("确定修改")]),t._v(" "),a("mt-button",{staticClass:"confirmBtn",attrs:{size:"large",type:"danger",plain:""},on:{click:function(e){t.phonePopupVisible=!1}}},[t._v("取消")])],1),t._v(" "),a("mt-popup",{staticClass:"mint-popup-fade",attrs:{position:"right",modal:!1},model:{value:t.pwdPopupVisible,callback:function(e){t.pwdPopupVisible=e},expression:"pwdPopupVisible"}},[a("div",{staticClass:"update-title"},[a("img",{attrs:{src:"static/img/img-update.svg"}}),t._v(" "),a("h5",[t._v("修改登录密码")])]),t._v(" "),t.updatePwdByPhone?[a("mt-field",{attrs:{label:"手机号",type:"tel",readonly:!0},model:{value:t.user.iphone,callback:function(e){t.$set(t.user,"iphone",e)},expression:"user.iphone"}}),t._v(" "),a("mt-field",{attrs:{label:"验证码",placeholder:"请输入验证码",attr:{maxLength:8}},model:{value:t.updatePwdData.sms,callback:function(e){t.$set(t.updatePwdData,"sms",e)},expression:"updatePwdData.sms"}},[a("a",{staticStyle:{color:"#aaa"},attrs:{href:"javascript: void(0);"},on:{click:function(e){t.getCode("pwd")}}},[t._v(t._s(t.pwdCodeMessage))])])]:[a("mt-field",{attrs:{label:"旧密码",type:"password",attr:{maxLength:20},placeholder:"请输入旧密码",state:t.updatePwdState.oldPassword},model:{value:t.updatePwdData.oldPassword,callback:function(e){t.$set(t.updatePwdData,"oldPassword",e)},expression:"updatePwdData.oldPassword"}})],t._v(" "),a("br"),t._v(" "),a("mt-field",{attrs:{label:"新密码",type:"password",attr:{maxLength:20},placeholder:"请输入新密码",state:t.updatePwdState.newPassword},model:{value:t.updatePwdData.newPassword,callback:function(e){t.$set(t.updatePwdData,"newPassword",e)},expression:"updatePwdData.newPassword"}}),t._v(" "),a("mt-field",{attrs:{label:"确认密码",type:"password",attr:{maxLength:20},placeholder:"再次输入新密码",state:t.updatePwdState.pwdConfirm},nativeOn:{"!blur":function(e){t.checkPwd()}},model:{value:t.updatePwdData.pwdConfirm,callback:function(e){t.$set(t.updatePwdData,"pwdConfirm",e)},expression:"updatePwdData.pwdConfirm"}}),t._v(" "),a("div",{staticStyle:{color:"red","font-size":"14px","text-align":"center"}},[t._v(t._s(t.pwdConfirmMessage))]),t._v(" "),a("br"),t._v(" "),a("div",{staticStyle:{width:"100%","text-align":"right"}},[a("span",{staticStyle:{"font-size":"14px","padding-right":"20px",color:"#888"},on:{click:t.pwdChange}},[t._v("\n        "+t._s(t.updatePwdByPhone?"←旧密码修改":"→手机验证码修改")+"\n      ")])]),t._v(" "),a("mt-button",{staticClass:"confirmBtn",attrs:{size:"large",type:"danger"},on:{click:t.updatePwd}},[t._v("确定修改")]),t._v(" "),a("mt-button",{staticClass:"confirmBtn",attrs:{size:"large",type:"danger",plain:""},on:{click:function(e){t.pwdPopupVisible=!1}}},[t._v("取消")])],2)],1)},staticRenderFns:[]}}});